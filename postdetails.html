<!DOCTYPE html>
<html lang="en">
<head>

        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- ------------------------------invoke bootstrap v5----------------------------- -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    
        <!-- ----------------------------------------import styleing sheet------------------------------------------- -->
        <link rel="stylesheet" href="styles.css">
    
        <!-- -------------------------------------------import box icons-------------------------------------------------- -->
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    
    
        <title>SocialApiProject</title>
            <!------------------------------------ giving title an image--------------------------------------------- -->
    <link rel="website icon" type="svg" href="assets/mylogo/png2svg/two.svg">

    
</head>
<body>
    

    <nav class="navbar navbar-expand-lg sticky-top shadow bg-light">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand" href="#">
                <img src="assets/mylogo/png2svg/two.svg" alt="Logo"  width="45" height="45" class=" ratio-1x1 rounded-circle overflow-hidden ">
                Social API 
              </a>
          <div class="search-bar rounded-pill p-2 mx-1 my-1  position-relative d-none d-md-block">
            <i class='bx bx-search  fs-3 position-absolute top-0 start-0 py-2 px-2 text-dark opacity-75'></i>
            <input type="search" placeholder="Search for every thing..." aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <div class="user-validity ">
            <div id="user-in" class="d-flex align-items-center gap-5">
                <img src="assets/home.jpg" title="my-home" alt="home" width="45" height="45" class=" ratio-1x1 rounded-circle overflow-hidden">
                <i id="log-out" class='bx bx-log-in-circle text-danger fs-2 icon' ></i>
            </div>
            <div id="user-out" class=" d-flex align-items-center gap-3">
                <button type="button" class="btn btn-primary"  data-bs-toggle="modal" data-bs-target="#login-modal">Log In</button>
                <button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#reg-modal">register</button>
            </div>
         </div>
        </div>
      </nav>
    
      <!-- -----------------------------------------------------start navigation bar------------------------------- -->
      <!-- -------------------------------------------start build modals for login and registers------------------------ -->
      <!-- ----------------------------------------------start login modal--------------------------------- -->
    
    
      <div class="modal fade login-modal" id="login-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog rounded">
          <div class="modal-content">
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                      <label for="recipient-name" class="col-form-label">Username:</label>
                      <input type="text" class="form-control" value="eslam99" id="user-name">
                    </div>
                    <div class="mb-3">
                      <label for="message-text" class="col-form-label">Password:</label>
                      <input type="password" class="form-control" value="123456" id="password">
                    </div>
                </form>
            </div>
            <div class="modal-footer rounded">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" id="log-in"  class="btn btn-primary" id="form-ptn">Login</button>
            </div>
          </div>
        </div>
      </div>
    
      <!-- ----------------------------------------------end login modal--------------------------------- ------------>
      <!-- ----------------------------------------------start register modal--------------------------------- ------------>
    
      <div class="modal fade" id="reg-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="register-moda">Register a new user </h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="mb-3">
                  <label for="recipient-name" class="col-form-label">Name:</label>
                  <input type="text" class="form-control"  id="reg-name">
                </div>
                <div class="mb-3">
                  <label for="recipient-name" class="col-form-label">Username:</label>
                  <input type="text" class="form-control"  id="reg-user-name">
                </div>
                <div class="mb-3">
                  <label for="message-text" class="col-form-label">Password:</label>
                  <input type="password" class="form-control" id="reg-password">
                </div>
            </form>
            </div>
            <div class="modal-footer">
              <button  type="button" class="btn btn-secondary" data-bs-dismiss="modal">Not Now</button>
              <button id="sign-Up" type="button" class="btn btn-success">SignUp</button>
            </div>
          </div>
        </div>
      </div>
    
      <!-- ----------------------------------------------end register modal--------------------------------- ------------>

      <!-- -----------------------------------------------start user posts--------------------------------------- -->

      <main id="main-content">
        <div class="container d-flex justify-content-center align-items-center flex-column">
      <div class="row justify-content-center">
        <section class="main-section col col-lg-9">
          <div id="post">
              <div class="card shadow">
                  <div class="card-header">
                      <img src="assets/prof2.jpg" class="rounded-circle" width="40" alt="">
                      <b class="mx-2 fs-6">@name</b>
                      <a class="back-home text-primary fs-1" href="index.html"><i class='bx bx-right-arrow-circle'></i></a>
                  </div>
                  <div class="card-body">
                      <img src="assets/wallpaperflare.com_wallpaper (1).jpg" class="w-100 rounded img-fluid" alt="">
                      <h6 class="mt-2 fs-6 text-black-50">20 min ago</h6>
                      <h5 class="mt-2 mb-2">Lorem ipsum dolor sit amet.</h5>
                      <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Numquam, nam!</p>
                  </div>
                  <div class="card-footer d-flex text-muted ">
                      <p class="fs-5"><i class='bx bx-pencil' ></i></p>
                      <p class="ms-3 ">(5) Comments</p>
                  </div>
              </div>
           </div>
           <div id="add-comment" class="input-group mt-2">
            <input id="text-comment" type="text" class="form-control p-2" placeholder="create your comment here.." >
            <button type="button" class="input-group-text btn btn-primary" id="basic-addon2" value="send" style="cursor: pointer; padding: 0.2rem;" onclick="commentAfterClick()">send</button>
          </div>        
      </section>
      </div>

         </div>
        </main>

      <!-- -----------------------------------------------end user posts--------------------------------------- -->

      

      <div id="showAlert" class="showAlert show fade"></div>



      
<!-- --------------------------------------start loader ----------------------------------------------- -->

<div id="loader">
  <div class="ball-scale">
    <div></div>
  </div>
</div>

   
     <!-- -------------------------------------------------------import axios library-------------------------------------- -->
     <script src="node_modules/axios/dist/axios.min.js"></script>

     <!-- ------------------------------------import main javascript-------------------------------------- -->
    <script src="main.js"></script>
    <!-- --------------------------------bootstrap v5-------------------------------------- -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>

</body>


<script>
        


    // داله جاهزه تستقبل رقم البوست
    const urlParams = new URLSearchParams(window.location.search);
    // that was send now take it
    const id = urlParams.get('postId');

  

userUi()






  function getPost(){
    getLoader(true)
    axios.get(`https://tarmeezacademy.com/api/v1/posts/${id}`)
    .then((response) => {
     
      let post= response.data.data;   
      let comments = post.comments;
      
      let commentsContent =``
      for(comment of comments){
      commentsContent +=`
      <hr>
      <div class="comment-owner">
      <img src="${post.author.profile_image}" class="rounded-circle me-3 p-1 " width="40" alt="not supp"><b class="text-muted text-capitalize fs-6">${comment.author.username}</b>
      <p class=" p-2">${comment.body}</p>
      </div>
  
      `
    }
  
      let content = `
      <div class="card mb-2 shadow">
         <div class="card-header">
             <img src="${post.author.profile_image}" class="rounded-circle" width="40" alt="not support">
             <b class="mx-2 fs-6">@${post.author.username}</b>
             <a class="back-home text-primary fs-3" href="index.html"><i class='bx bx-right-arrow-circle'></i></a>
         </div>
         <div class="card-body">
             <img src="${post.image}" class="w-100 rounded img-fluid" alt="profile photo">
             <h5 class="my-2">${post.body}</h5>
             <h6 class="mt-2 text-muted text-capitalize fs-6">${post.author.name}</h6>
             <p class="float-end text-muted">${post.created_at}</p>
         </div>
         <div class="card-footer d-flex text-muted ">
             <p class="fs-5"><i class='bx bx-pencil' ></i></p>
             <p class="ms-3 ">(${post.comments_count}) Comments</p>
         </div>
     </div>
     <div id="post-comment" class="bg-light rounded p3">
      ${commentsContent}
     </div>
    `

    document.getElementById('post').innerHTML = content;
    

}).finally(()=>{
  getLoader(false);
})

}
getPost()



function commentAfterClick(){
  let comment = document.getElementById('text-comment').value;
  let param ={
    "body": comment
  }
  
  getLoader(true)
  axios.post(`https://tarmeezacademy.com/api/v1/posts/${id || 1}/comments` ,param,{
   headers: {
    "authorization" : `Bearer ${localStorage.getItem('token')}`
   }
  }).then((response)=>{

    getPost()
    showAlert('the post has been published successfuly','success')
  })
  .catch(error=>{
    showAlert(error.response.data.message,'danger')
}).finally(()=>{
  getLoader(false)
})

}
</script>
</html>